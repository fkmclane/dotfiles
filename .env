# set up local environment
export EDITOR="nvim"
export EMAIL="fkmclane@fkmclane.net"
export GOPATH="$HOME/.local/go"
export PATH="$HOME/.local/bin:$GOPATH/bin:$PATH"

# man page highlighting
export LESS_TERMCAP_mb=$'\e[01;31m'
export LESS_TERMCAP_md=$'\e[01;34m'
export LESS_TERMCAP_me=$'\e[0m'
export LESS_TERMCAP_se=$'\e[0m'
export LESS_TERMCAP_so=$'\e[01;31m'
export LESS_TERMCAP_ue=$'\e[0m'
export LESS_TERMCAP_us=$'\e[01;32m'

# aliases and functions
alias grep="grep --colour=auto"
alias ls="ls --color=auto -h"
alias df="df -h"
alias du="du -h"
alias free="free -h"
alias bc="bc -l"
alias sudo="sudo -E"
alias curl="curl -L"
alias cget="curl -fJO --progress-bar --retry 10 -C -"
alias nyancat="TERM=xterm nyancat"

open() {
	for file in "$@"; do
		if [ -e "$file" ]; then
			setsid xdg-open "$file" &>/dev/null
		else
			echo "open: $file: file not found"
		fi
	done
}

cal() {
	/usr/bin/cal -m $3 $2 $1
}

mail() {
	/usr/bin/mail $@ -- -f $EMAIL
}

twitch() {
	source /mnt/crypt/foster/twitch/key

	INRES="1920x1080"
	OUTRES="1920x1080"
	FPS="15"
	GOP="30"
	GOPMIN="15"
	THREADS="2"
	CBR="1000k"
	QUALITY="fast"
	AUDIO_RATE="44100"
	URI="rtmp://live-iad.twitch.tv/app/$STREAM_KEY"

	ffmpeg -v warning -f x11grab -s $INRES -r $FPS -i :0.0 -f alsa -i pulse -f flv -ac 2 -ar $AUDIO_RATE -c:v libx264 -g $GOP -keyint_min $GOPMIN -b:v $CBR -minrate $CBR -maxrate $CBR -pix_fmt yuv420p -s $OUTRES -preset $QUALITY -tune film -c:a libmp3lame -threads $THREADS -strict normal -bufsize $CBR "$URI"

	STREAM_KEY=
}

record() {
	RES="1920x1080"
	FPS="15"

	ffmpeg -v warning -f x11grab -s $RES -r $FPS -i :0.0 -f alsa -i pulse "$@"
}

# fix xdg-open opening unknown stuff in firefox
export BROWSER="false"

# password-store
export PASSWORD_STORE_X_SELECTION="primary"
