#!/bin/sh
if [ "$XDG_SESSION_DESKTOP" == "steam" ]; then
  config_dir="nvidia.conf.d"
  pkexec /sbin/modprobe nvidia
  pkexec /sbin/modprobe nvidia_modeset
  pkexec /sbin/modprobe nvidia_drm
else
  config_dir="intel.conf.d"
fi

if [ -z "$XDG_VTNR" ]; then
  /usr/bin/X -nolisten tcp -configdir "$config_dir" "$@"
else
  /usr/bin/X -nolisten tcp -configdir "$config_dir" "$@" vt$XDG_VTNR
fi

if [ "$XDG_SESSION_DESKTOP" == "steam" ]; then
  pkexec /sbin/modprobe -r nvidia_drm
  pkexec /sbin/modprobe -r nvidia_modeset
  pkexec /sbin/modprobe -r nvidia
fi

unset config_dir
